{% extends "base.html" %}
{% block title %}Cost Calculator{% endblock %}
{% block content %}
  <h1 class="mb-3">Trip Cost Calculator</h1>
  <div class="card shadow-sm">
    <div class="card-body">
      <form
        id="cost-form"
        method="post"
        action="{% url 'calculators:cost' %}"
        hx-post="{% url 'calculators:cost-partial' %}"
        hx-target="#cost-results"
        hx-swap="outerHTML show:top"
        aria-describedby="cost-form-help">
        {% csrf_token %}

        <p id="cost-form-help" class="form-text">Fill origin/destination, choose unit and route factor, then provide fuel economy and price.</p>

        {% if form.non_field_errors %}
          <div class="alert alert-danger" role="alert" aria-live="assertive">
            {{ form.non_field_errors }}
          </div>
        {% endif %}

        {% with origin_error_id="id_origin-error" destination_error_id="id_destination-error" unit_error_id="id_unit-error" route_factor_error_id="id_route_factor-error" fuel_economy_error_id="id_fuel_economy_l_per_100km-error" fuel_price_error_id="id_fuel_price_per_liter-error" %}
          <div class="row g-3">
            <div class="col-md-6">
              <label for="{{ form.origin.id_for_label }}" class="form-label">Origin</label>
              {{ form.origin }}
              <p id="{{ form.origin.id_for_label }}-help" class="form-text">{{ form.origin.help_text }}</p>
              {% if form.origin.errors %}
                <div id="{{ origin_error_id }}" class="invalid-feedback d-block">
                  {{ form.origin.errors }}
                </div>
              {% endif %}
            </div>

            <div class="col-md-6">
              <label for="{{ form.destination.id_for_label }}" class="form-label">Destination</label>
              {{ form.destination }}
              <p id="{{ form.destination.id_for_label }}-help" class="form-text">{{ form.destination.help_text }}</p>
              {% if form.destination.errors %}
                <div id="{{ destination_error_id }}" class="invalid-feedback d-block">
                  {{ form.destination.errors }}
                </div>
              {% endif %}
            </div>
          </div>

          <div class="row g-3 mt-1">
            <div class="col-md-4">
              <label for="{{ form.unit.id_for_label }}" class="form-label">Unit</label>
              {{ form.unit }}
              <p id="{{ form.unit.id_for_label }}-help" class="form-text">{{ form.unit.help_text }}</p>
              {% if form.unit.errors %}
                <div id="{{ unit_error_id }}" class="invalid-feedback d-block">
                  {{ form.unit.errors }}
                </div>
              {% endif %}
            </div>

            <div class="col-md-4">
              <label for="{{ form.route_factor.id_for_label }}" class="form-label">Route Factor</label>
              {{ form.route_factor }}
              <p id="{{ form.route_factor.id_for_label }}-help" class="form-text">{{ form.route_factor.help_text }}</p>
              {% if form.route_factor.errors %}
                <div id="{{ route_factor_error_id }}" class="invalid-feedback d-block">
                  {{ form.route_factor.errors }}
                </div>
              {% endif %}
            </div>
          </div>

          <div class="row g-3 mt-1">
            <div class="col-md-6">
              <label for="{{ form.fuel_economy_l_per_100km.id_for_label }}" class="form-label">Fuel Economy (L/100km)</label>
              {{ form.fuel_economy_l_per_100km }}
              <p id="{{ form.fuel_economy_l_per_100km.id_for_label }}-help" class="form-text">{{ form.fuel_economy_l_per_100km.help_text }}</p>
              {% if form.fuel_economy_l_per_100km.errors %}
                <div id="{{ fuel_economy_error_id }}" class="invalid-feedback d-block">
                  {{ form.fuel_economy_l_per_100km.errors }}
                </div>
              {% endif %}
            </div>

            <div class="col-md-6">
              <label for="{{ form.fuel_price_per_liter.id_for_label }}" class="form-label">Fuel Price (/L)</label>
              {{ form.fuel_price_per_liter }}
              <p id="{{ form.fuel_price_per_liter.id_for_label }}-help" class="form-text">{{ form.fuel_price_per_liter.help_text }}</p>
              {% if form.fuel_price_per_liter.errors %}
                <div id="{{ fuel_price_error_id }}" class="invalid-feedback d-block">
                  {{ form.fuel_price_per_liter.errors }}
                </div>
              {% endif %}
            </div>
          </div>
        {% endwith %}

        <div class="mt-3">
          <button type="submit" class="btn btn-primary">Estimate Cost</button>
        </div>
      </form>
    </div>
  </div>

  <div id="cost-results" class="mt-4" role="region" aria-label="Cost results" aria-live="polite">
    {% if fuel_cost is not None %}
      {% include "calculators/partials/cost_result.html" %}
    {% endif %}
  </div>
{% endblock %}
