{% extends "base.html" %}
{% block title %}Distance Calculator{% endblock %}
{% block content %}
  <h1>Distance Calculator</h1>
  <form
    id="distance-form"
    method="post"
    action="{% url 'calculators:distance' %}"
    hx-post="{% url 'calculators:distance-partial' %}"
    hx-target="#distance-results"
    hx-swap="outerHTML show:top"
    aria-describedby="distance-form-help">
    {% csrf_token %}

    <p id="distance-form-help" class="form-text">Enter origin and destination airport/city codes; choose unit and optional route factor.</p>

    {% if form.non_field_errors %}
      <div class="alert alert-danger" role="alert" aria-live="assertive">
        {{ form.non_field_errors }}
      </div>
    {% endif %}

    {% with origin_error_id="id_origin-error" destination_error_id="id_destination-error" route_factor_error_id="id_route_factor-error" unit_error_id="id_unit-error" %}
      <div class="mb-3">
        <label for="{{ form.origin.id_for_label }}" class="form-label">Origin</label>
        {{ form.origin }}
        <p id="{{ form.origin.id_for_label }}-help" class="form-text">{{ form.origin.help_text }}</p>
        {% if form.origin.errors %}
          <div id="{{ origin_error_id }}" class="invalid-feedback d-block">
            {{ form.origin.errors }}
          </div>
        {% endif %}
      </div>

      <div class="mb-3">
        <label for="{{ form.destination.id_for_label }}" class="form-label">Destination</label>
        {{ form.destination }}
        <p id="{{ form.destination.id_for_label }}-help" class="form-text">{{ form.destination.help_text }}</p>
        {% if form.destination.errors %}
          <div id="{{ destination_error_id }}" class="invalid-feedback d-block">
            {{ form.destination.errors }}
          </div>
        {% endif %}
      </div>

      <div class="mb-3">
        <label for="{{ form.unit.id_for_label }}" class="form-label">Unit</label>
        {{ form.unit }}
        <p id="{{ form.unit.id_for_label }}-help" class="form-text">{{ form.unit.help_text }}</p>
        {% if form.unit.errors %}
          <div id="{{ unit_error_id }}" class="invalid-feedback d-block">
            {{ form.unit.errors }}
          </div>
        {% endif %}
      </div>

      <div class="mb-3">
        <label for="{{ form.route_factor.id_for_label }}" class="form-label">Route Factor</label>
        {{ form.route_factor }}
        <p id="{{ form.route_factor.id_for_label }}-help" class="form-text">{{ form.route_factor.help_text }}</p>
        {% if form.route_factor.errors %}
          <div id="{{ route_factor_error_id }}" class="invalid-feedback d-block">
            {{ form.route_factor.errors }}
          </div>
        {% endif %}
      </div>
    {% endwith %}

    <button type="submit" class="btn btn-primary">Calculate</button>
  </form>

  <div id="distance-results" class="mt-4" role="region" aria-label="Distance results" aria-live="polite">
    {% if flight_distance is not None %}
      {% include "calculators/partials/distance_result.html" %}
    {% endif %}
  </div>
{% endblock %}
